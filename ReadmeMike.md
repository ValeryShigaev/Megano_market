#Скидки

Предусмотрено три вида скидок: *productdiscount*, *groupdiscount*, *cartdiscount*.
Все скидки привязаны к конкретному манагазину (один ко многим)

<u>*Productdiscount*</u> действуют на выбранный товар или товары. Отношение скидка-товар много-ко-многим: на один и тот же
товар могут быть заведены несколько скидок и скидка может действовать на несколько товаров.

<u>*Groupdiscount*</u> действует на категорию товаров в магазине. Например, скидка 3% на все компьютеры.

<u>*Cartdiscount*</u> применяется к товарам в корзине в зависимости от количества товаров в корзине или общей стоимости товаров в корзине.
Например, если в корзине больше 3 товаров или общая стоимость больше 3000 р., то применяется скидка в 3%.

Все три вида скидок делятся на три типа: скидка в процентах, скидка - фиксированная сумма, фиксированная новая (акционная цена).
Например, скидка в 5% или скидка в 150 р. или установленная акционная цена в 1225 р.

Кроме того товарные скидки (Productdiscount) могут иметь атрибут set_discount (скидка на набор).
В этом случае скидка применяется к набору, т.е. только если все товары, на которые установлена эта скидка,
попали в корзину.
Например, при покупке телефона и чехла скидка 200 р. Если хотя бы один из товаров не попал в корзину,
скидка не применяется.

Все скидки можно отразить в таблице:

Typy/sort    | Productdiscount | Groupdiscount | Cartdiscount|
-------------|-----------------|---------------|-------------|
Percent      |   regular or set   |               |             |
Fixed amount |   regular or set   |               |             |
Fixed price  |   regular or set   |               |             |

Также все скидки имеют три уровня приоритетности: низкий, средний и высокий, что позводяет применять
все виды скидок комплексно.

Пример комплексного применения скидок

Скидка на корзину от 3 товаров - 5% с низким приоритетом

Скидка на телефоны - 150 руб. со средним приоритетом

Скидка на конкретный телефон А с чехлом - 500 руб. с высоким приоритетом

Демонстрация списка и детальной страницы скидок

Демонстрация на магазине

На главной странице, странице скидок и предложений и др возможных местах отображаются товарные скидки.


#Баннер

Три рандомных баннера закэшированы на 10 минут.
Баннер привязан к товарной скидке отношением 1-к-1


#Корзина

Добавление товара в корзину происходит с любой страницы, где есть товары, по нажатию на иконку с сумкой
В корзину добавляется 1 шт. этого товара. Если в корзине уже есть этот товар, то его количество увеличивается на 1 шт.
При этом количество товара в магазине уменьшается на 1 шт. Если товара в магазине нет, он не добавляется в корзину и не списывается
из магазина.

На странице самой корзины можно изменить количество товара. Например была 1 шт, а мы хотим купить 3.
При нахажатии на udate количество меняется с 1 на 3. При этом из магазина списывается 2 единицы товара.
Если товара в магазине не достаточно, в корзине остается старое количество товара.

Если этот товар продается в другом магазине, то в корзине можно выбрать другой магазин. При обновлении
(update) количество товара в старом магазине увеличится, в новом - спишется, при условии, что товара
в новом магазине длстаточно.

Если в корзине лежит один и тот же товар, но из разных магазинов и мы меняем один из магазинов на другой,
то количество складывается, а вторая позиция удаляется из корзины.

Также при удалении товара из корзины, количество этого товара возвращается в магазин.

При логине анонимного пользователя товары из корзины "сливаются" с корзиной пользователя,
если до этого он был залогинен и собирал корзину.

При регистрации анонима, корзина также "перетекает" в корзину залогиненного пользователя.

Демонстрация добавления, удаления и изменения количества товара в корзине, а также демонстраиция
слияния корзин.

#Заказ и оплата

При нажатии на заказ из корзины, если пользователь не залогинен, он может зарегистрироваться или залогиниться.
В заказ попадают товары с финальной ценой после примененных скидок. На втором шаге оформления заказа выбирается
вид доставки, заполняется адрес и город

На третьем шаге выбирается способ оплаты: картой или рандомным счетом.
На четвертом шаге заказ получает статус оформлен. Выводится вся информация по заказу, сумма доставки и общая сумма с учетом доставки
Сумма доставки расчитывается исходя из финальной суммы заказа и типа доставки.

При выбранной оплате картой, предлагается ввести номер карты, CVV и дату действия карты. Оплата симулируется через сторонний сервис Braintree
При удачной оплате, происходит переход на страницу об успешной оплате и статус заказа меняется на "оплаченный"

При неудачной оплате, происходит переход на страницу об ошибке и заказ остается неоплаченным.

При оплате счетом, происходит валидация счета сервисом оплаты и аналогично как с картой.
Можно также обратится к сервису оплаты API запросом. Например из бота.

Есть две команды: получение статуса указанного заказа или оплата указанного заказа рандомным счетом
Валидация аналогична как при оплате с сайта.

Возможные статусы заказа: paid, not paid.
При отсутствии заказа с указанным номером, вместо статуса будет сообщение, что такого заказа нет.

Если оплата прошла, приходит сообщение: payment processed.
При любых ошибках валидации или отсутствии заказа с таким номером: payment not processed.
Демонстрация оформления.